Nano Sales - Payment Gateway Helper
===================================

**WARNING: this project requires `yarn`**
`sudo npm install -g yarn`

This payment gateway helper is configured with three files:

`wallet.seed` is this server's private key, it is used to generate addresses for the address pool and to sign transactions for settling. If file is not provided it will generate a random seed at startup.

`settle.pub` is the shop's settlement address, it is where this server will send the collected funds when addresses are released. If one is not provided the payments will never settle and new addresses will be generated new payments.

`config.json` is a file with the follwing structure:

```
{
    "minPoolAddresses": 5, //minimum number of addresses to be generated by the pool
    "nodeWs": "wss://localnode:7078",
    "nodeRpc": "http://localnode",
    "workRpc": "http://localnode:7076" // OPTIONAL work server url
}
```

Three simple http endpoints:

## POST /sales

This endpoint creates/allocates an address for the payment, registering a callback url and a desired amount.

The shop receives back the address.

Once any block is confirmed for that address the callback is called via GET, no payload.

*Input:*

```
{
    "callback": "my.shop/update-payment/123", // unique url for updating a payment status
    "amount": 1000000000000000000000000000000 // amount in RAW (1 nano)
}
```

*Output:*

```
{
    "address": "nano_3oneTimeDepositAddressToDisplayAtTheCheckoutPage111111111111"
}
```

## GET /sales/nano_3oneTimeDepositAddressToDisplayAtTheCheckoutPage111111111111

This endpoint informs the shop about the payment status, it is meant to be called right after the shop receives a callback. Meaning the shop must store the address for that order on their side.

*Output:*

```
{
    "paid": false, // boolean that indicates if paid amount is greater or equal than requested amount
    "price": 1000000000000000000000000000000,
    "balance": 990000000000000000000000000000
}
```

## DELETE /sales/nano_3oneTimeDepositAddressToDisplayAtTheCheckoutPage111111111111

Once payment is confirmed on the shop it can release the address and settle the balance on their main address.
It is recommended that uppon settlement the address is removed from the shop's order information to avoid mix ups.
TODO: generate logs for every transaction.

# BUILDING

`yarn install`
`yarn build`

# RUNNING

`yarn serve`

# DONATION

If it works for you, throw me a bone:
nano_3ntf6crkan6114rfb39d51udqdw4mrbt1x7n8uphx44ojhxcjo3exhk6dsme
![nano_3ntf6crkan6114rfb39d51udqdw4mrbt1x7n8uphx44ojhxcjo3exhk6dsme](data:image/png;base64,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)
